<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tạo Nhân Vật AI</title>
  <style>
    body {font-family: 'Segoe UI', sans-serif;background: linear-gradient(135deg, #1e3c72, #2a5298);color: white;text-align: center;padding: 40px;}
    h1 {font-size: 2.5em;margin-bottom: 10px;}
    input, button {padding: 12px;margin: 10px;font-size: 1.1em;border: none;border-radius: 8px;}
    input {width: 70%;max-width: 500px;}
    button {background: #ff6b6b;color: white;cursor: pointer;transition: 0.3s;}
    button:hover {background: #ff5252;}
    #result {margin-top: 30px;}
    img {max-width: 100%;border-radius: 12px;box-shadow: 0 10px 20px rgba(0,0,0,0.3);}
    .loading {color: #ffd93d;font-style: italic;}
  </style>
</head>
<body>

  <h1>🧙‍♂️ Tạo Nhân Vật Fantasy</h1>
  <p>Nhập mô tả → AI vẽ ngay!</p>

  <input type="text" id="prompt" placeholder="VD: nữ pháp sư băng, tóc trắng, áo choàng xanh, cầm gậy phép" />
  <br/>
  <button onclick="taoAnh()">Tạo Nhân Vật!</button>

  <div id="result"></div>

 <script>
async function taoAnh() {
  const prompt = document.getElementById("prompt").value.trim();
  if (!prompt) { alert("Hãy nhập mô tả!"); return; }

  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = `<p class="loading">Đang vẽ... ⏳</p>`;

  try {
    const response = await fetch("https://api.replicate.com/v1/predictions", {
      method: "POST",
      headers: {
        "Authorization": "Bearer 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", // Lấy ở replicate.com/account
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        version: "stability-ai/stable-diffusion:ac732df83cea7fff18b8472768c88ad041fa750ff7682a21bdea9ed1743e3fae",
        input: { prompt: prompt + ", fantasy character, detailed, vibrant, anime style" }
      })
    });

    const data = await response.json();
    const predictionId = data.id;

    // Polling kết quả
    let result;
    do {
      await new Promise(r => setTimeout(r, 2000));
      const poll = await fetch(`https://api.replicate.com/v1/predictions/${predictionId}`, {
        headers: { "Authorization": "Token r8_YourToken" }
      });
      result = await poll.json();
    } while (result.status !== "succeeded" && result.status !== "failed");

    if (result.status === "succeeded") {
      const imgUrl = result.output[0];
      resultDiv.innerHTML = `
        <p>Hoàn tất!</p>
        <img src="${imgUrl}" />
        <br/><button onclick="window.open('${imgUrl}')">Tải ảnh</button>
      `;
    } else {
      throw new Error("Tạo ảnh thất bại");
    }
  } catch (err) {
    resultDiv.innerHTML = `<p style="color:#ff6b6b">Lỗi: ${err.message}</p>`;
  }
}
</script>
</body>

</html>
