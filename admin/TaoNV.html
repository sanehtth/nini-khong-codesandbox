<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>T·∫°o Nh√¢n V·∫≠t AI ‚Äî 3 Ch·∫ø ƒê·ªô</title>
  <style>
    body{font-family:"Segoe UI",sans-serif;background:linear-gradient(135deg,#1e3c72,#2a5298);color:white;margin:0;padding:20px;text-align:center}
    h1{font-size:2em;margin-bottom:10px}
    .mode-select{display:flex;justify-content:center;gap:10px;margin:20px auto;flex-wrap:wrap}
    .opt{padding:12px 20px;border-radius:10px;background:rgba(255,255,255,0.1);cursor:pointer;transition:.2s;border:1px solid rgba(255,255,255,0.2)}
    .opt.active{background:#ff6b6b}
    .pane{display:none;margin-top:20px}
    .pane.show{display:block}
    input,select,button{padding:10px;margin:6px;border:none;border-radius:8px;font-size:1em}
    button{background:#ff6b6b;color:white;cursor:pointer}
    button:hover{background:#ff5252}
    iframe{width:100%;height:70vh;border-radius:12px;border:none}
    .status{margin-top:10px;font-style:italic;color:#ffd93d}
    img{max-width:100%;border-radius:10px;margin-top:20px;box-shadow:0 6px 20px rgba(0,0,0,0.4)}
  </style>
</head>
<body>

  <h1>üßô‚Äç‚ôÇÔ∏è T·∫°o Nh√¢n V·∫≠t Fantasy (3 ch·∫ø ƒë·ªô)</h1>

  <div class="mode-select" id="modeSelect">
    <div class="opt" data-mode="free">Mi·ªÖn ph√≠</div>
    <div class="opt" data-mode="hf">HuggingFace API</div>
    <div class="opt" data-mode="replicate">Replicate API</div>
  </div>

  <!-- MODE 1: FREE -->
  <div id="paneFree" class="pane show">
    <p>D√πng Hugging Face Space mi·ªÖn ph√≠ (iframe, kh√¥ng c·∫ßn API).</p>
    <iframe src="https://huggingface.co/spaces/hysts/SDXL/embed" title="HF Free Space"></iframe>
  </div>

  <!-- MODE 2: HUGGING FACE API -->
  <div id="paneHF" class="pane">
    <p>G·ªçi tr·ª±c ti·∫øp model qua Hugging Face API (token hf_...)</p>
    <input type="text" id="hfPrompt" placeholder="VD: c√¥ g√°i t√≥c tr·∫Øng, √°nh s√°ng huy·ªÅn ·∫£o..." size="50"/>
    <br>
    <button onclick="generateHF()">T·∫°o ·∫¢nh (HF)</button>
    <div id="hfStatus" class="status"></div>
    <div id="hfResult"></div>
  </div>

  <!-- MODE 3: REPLICATE -->
  <div id="paneReplicate" class="pane">
    <p>G·ªçi Replicate API (token r8_...) - ch·∫•t l∆∞·ª£ng cao.</p>
    <input type="text" id="repPrompt" placeholder="VD: nh√¢n v·∫≠t nam phong c√°ch Pixar, √°o gi√°p v√†ng..." size="50"/>
    <br>
    <button onclick="generateReplicate()">T·∫°o ·∫¢nh (Replicate)</button>
    <div id="repStatus" class="status"></div>
    <div id="repResult"></div>
  </div>

  <script>
    // === Mode switching ===
    const modes = document.querySelectorAll(".opt");
    const panes = {
      free: document.getElementById("paneFree"),
      hf: document.getElementById("paneHF"),
      replicate: document.getElementById("paneReplicate")
    };
    modes.forEach(opt=>{
      opt.addEventListener("click",()=>{
        modes.forEach(o=>o.classList.remove("active"));
        opt.classList.add("active");
        const mode = opt.dataset.mode;
        Object.keys(panes).forEach(k=>panes[k].classList.toggle("show",k===mode));
      });
    });
    modes[0].classList.add("active");

    // === Hugging Face API ===
    async function generateHF(){
      const prompt=document.getElementById("hfPrompt").value.trim();
      if(!prompt){alert("Nh·∫≠p m√¥ t·∫£!");return;}
      const status=document.getElementById("hfStatus");
      const result=document.getElementById("hfResult");
      status.textContent="‚è≥ ƒêang t·∫°o ·∫£nh (HuggingFace)...";
      result.innerHTML="";
      try{
        const resp=await fetch("/.netlify/functions/hf-proxy",{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({
            model:"black-forest-labs/FLUX.1.1-pro",
            input:{inputs:prompt}
          })
        });
        if(!resp.ok) throw new Error("HTTP "+resp.status);
        const data=await resp.json();
        if(data.error) throw new Error(data.error);
        status.textContent="‚úÖ Ho√†n t·∫•t!";
        result.innerHTML=`<img src="${data.url||data.output?.[0]}" alt="HF result"/>`;
      }catch(e){
        status.textContent="‚ùå L·ªói: "+e.message;
      }
    }

    // === Replicate API ===
    async function generateReplicate(){
      const prompt=document.getElementById("repPrompt").value.trim();
      if(!prompt){alert("Nh·∫≠p m√¥ t·∫£!");return;}
      const status=document.getElementById("repStatus");
      const result=document.getElementById("repResult");
      status.textContent="‚è≥ ƒêang g·ª≠i y√™u c·∫ßu Replicate...";
      result.innerHTML="";
      try{
        const start=await fetch("/.netlify/functions/replicate-proxy",{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({
            model:"black-forest-labs/flux-1.1-pro",
            input:{prompt}
          })
        });
        if(!start.ok) throw new Error("HTTP "+start.status);
        const job=await start.json();
        let data=job;
        while(["starting","processing","queued"].includes(data.status)){
          await new Promise(r=>setTimeout(r,2000));
          const poll=await fetch("/.netlify/functions/replicate-get?id="+job.id);
          data=await poll.json();
        }
        if(data.status!=="succeeded") throw new Error(data.error||"Job fail");
        status.textContent="‚úÖ Ho√†n t·∫•t!";
        result.innerHTML=`<img src="${data.output[0]}" alt="Replicate result"/>`;
      }catch(e){
        status.textContent="‚ùå L·ªói: "+e.message;
      }
    }
  </script>
</body>
</html>
