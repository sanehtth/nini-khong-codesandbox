<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NiNi — Funny</title>

  <!-- Base styles của bạn -->
  <link rel="stylesheet" href="/test/css/base.css">
  <link rel="stylesheet" href="/test/css/footerss.css">
  <link rel="stylesheet" href="/test/css/auth-modal.css">
  <link rel="stylesheet" href="/test/css/stage.css">

  <!-- (tuỳ chọn) theme boot (logo/slogan override, cache) -->
  <script src="/test/js/theme-boot.js" defer></script>

  <!-- Firebase glue (chỉ 1 lần) -->
  <script type="module" src="/public/js/nini-fb.mjs"></script>

  <style>
    :root{
      --glass-bg: rgba(255,255,255,.08);
      --glass-brd: rgba(255,255,255,.35);
      --panel-radius: 18px;
    }

    body.home {
      /* gradient sẵn của base.css */
    }

    /* ======= HEADER ======= */
    .topbar{
      position:sticky; top:16px; z-index:30;
      display:flex; align-items:center; justify-content:center;
    }
    .topbar-inner{
      display:flex; align-items:center; gap:14px;
      background: var(--glass-bg);
      border:1px solid var(--glass-brd);
      border-radius: 999px;
      padding: 8px 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.15);
    }
    .brand{
      display:flex; align-items:center; gap:10px; padding: 0 6px;
    }
    .brand .logo{
      width:60px;height:28px;background:url('/public/assets/icons/logonini.svg') center/contain no-repeat;
    }
    .brand .slogan{ color:#fff; opacity:.9; font-weight:600; white-space:nowrap; }

    .tabs{
      display:flex; gap:8px; margin-left:10px;
    }
    .pill{
      padding:8px 14px; border-radius:999px; cursor:pointer;
      background:rgba(0,0,0,.35); color:#fff; font-weight:600; border:1px solid rgba(255,255,255,.25);
      backdrop-filter: blur(8px);
      transition: .2s;
    }
    .pill:hover{ transform:translateY(-1px); background:rgba(0,0,0,.45); }

    .user{
      margin-left:10px; position:relative;
      display:flex; align-items:center; gap:8px;
    }
    .avatar{
      width:32px; height:32px; border-radius:50%; background:#ececff; color:#4b47ff;
      display:grid; place-items:center; font-weight:800; cursor:pointer;
      background-image: var(--ava-bg, none); background-size:cover; background-position:center;
      border:1px solid var(--glass-brd);
    }
    .menu{
      position:absolute; right:0; top:120%;
      min-width:160px;
      background: var(--glass-bg);
      border:1px solid var(--glass-brd);
      backdrop-filter: blur(12px);
      border-radius:12px; padding:6px; display:none;
    }
    .menu.open{ display:block; }
    .menu button{
      width:100%; text-align:left; border:0; background:transparent; color:#fff;
      padding:8px 10px; border-radius:10px; cursor:pointer;
    }
    .menu button:hover{ background:rgba(255,255,255,.08); }

    /* ======= LAYOUT ======= */
    .shell{
      display:flex; gap:18px; padding: 88px 16px 32px; /* chừa chỗ cho header sticky */
      max-width:1280px; margin:0 auto;
    }
    .sidebar{
      width:64px; flex:0 0 64px;
      display:flex; flex-direction:column; gap:12px;
    }
    .sidebtn{
      width:64px; height:64px; border-radius:14px; border:1px solid var(--glass-brd);
      background:var(--glass-bg) center/30px no-repeat; color:#fff; cursor:pointer;
      backdrop-filter: blur(8px);
      transition:.2s;
    }
    .sidebtn:hover{ transform:translateY(-1px); background-color:rgba(255,255,255,.12); }
    .sidebtn[data-route="storybook"]{ background-image:url('/public/assets/icons/book.svg'); }
    .sidebtn[data-route="video"]{ background-image:url('/public/assets/icons/video.svg'); }
    .sidebtn[data-route="game"]{ background-image:url('/public/assets/icons/gamepad.svg'); }
    .sidebtn[data-route="shop"]{ background-image:url('/public/assets/icons/shop.svg'); }

    /* Content: list + detail */
    .stage{
      flex:1; display:flex; gap:16px; min-height:420px;
    }
    .panel{
      background: var(--glass-bg);
      border:1px solid var(--glass-brd);
      backdrop-filter: blur(12px);
      border-radius: var(--panel-radius);
      box-shadow: 0 10px 30px rgba(0,0,0,.15);
      color:#fff;
    }
    .list{ width:320px; flex:0 0 320px; padding:16px; display:flex; flex-direction:column; gap:12px; }
    .detail{ flex:1; padding:16px; }

    .list h3, .detail h3{ margin:0 0 12px 0; }
    .book, .video, .game, .item{
      border:1px solid var(--glass-brd); border-radius:14px; padding:12px;
      background:rgba(0,0,0,.15); cursor:pointer; transition:.2s;
    }
    .book:hover, .video:hover, .game:hover, .item:hover{ background:rgba(0,0,0,.25); transform:translateY(-1px); }

    /* ======= MODAL AUTH ======= */
    #authModal{
      position:fixed; inset:0; display:none; place-items:center; z-index:50;
      background:rgba(0,0,0,.25);
    }
    #authModal.open{ display:grid; }
    .auth-box{
      width: 520px; max-width:calc(100vw - 32px);
      background: var(--glass-bg);
      border:1px solid var(--glass-brd); backdrop-filter: blur(12px);
      border-radius:18px; padding:18px;
      color:#fff;
    }
    .auth-tabs{ display:flex; gap:8px; margin-bottom:12px; }
    .auth-tabs .pill{ background:rgba(0,0,0,.45); }
    .auth-row{ display:flex; flex-direction:column; gap:6px; margin:10px 0; }
    .auth-row input{ width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--glass-brd); background:rgba(0,0,0,.2); color:#fff; }
    .auth-actions{ display:flex; gap:8px; flex-wrap:wrap; }

    /* helper hidden */
    .hide{ display:none !important; }
  </style>
</head>
<body class="home">

  <!-- ======= HEADER ======= -->
  <div class="topbar">
    <div class="topbar-inner" id="nini_header">
      <div class="brand">
        <a class="logo" href="#/home" title="NiNi — Funny"></a>
        <span class="slogan">chơi mê ly, bứt phá tư duy</span>
      </div>

      <nav class="tabs">
        <button class="pill" data-nav="#/home">Giới thiệu</button>
        <button class="pill" data-nav="#/rules">Luật chơi</button>
        <button class="pill" data-nav="#/forum">Diễn đàn</button>
        <button class="pill" data-nav="#/feedback">Góp ý</button>
      </nav>

      <div class="user" id="userArea">
        <button id="btnAuthOpen" class="pill" type="button">Đăng nhập</button>

        <div id="userInfo" class="hide" style="display:flex; align-items:center; gap:8px;">
          <div id="btnProfile" class="avatar" title="Hồ sơ" data-letter="U"></div>
          <span id="userNick" style="font-weight:700;">NiNi</span>
          <div class="menu" id="userMenu">
            <button data-nav="#/profile">Hồ sơ</button>
            <button id="btnSignOut">Đăng xuất</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ======= BODY: SIDEBAR + STAGE ======= -->
  <div class="shell">
    <aside class="sidebar">
      <button class="sidebtn" title="Storybook" data-route="storybook"></button>
      <button class="sidebtn" title="Video" data-route="video"></button>
      <button class="sidebtn" title="Game" data-route="game"></button>
      <button class="sidebtn" title="Shop" data-route="shop"></button>
    </aside>

    <main class="stage">
      <section class="panel list" id="listPane">
        <!-- render bằng JS -->
      </section>
      <section class="panel detail" id="detailPane">
        <!-- render bằng JS -->
      </section>
    </main>
  </div>

  <!-- ======= AUTH MODAL ======= -->
  <div id="authModal" aria-hidden="true">
    <div class="auth-box">
      <div class="auth-tabs">
        <button class="pill" data-auth-tab="login">Đăng nhập</button>
        <button class="pill" data-auth-tab="signup">Đăng ký</button>
        <button class="pill" data-auth-tab="reset">Quên mật khẩu</button>
        <div style="flex:1"></div>
        <button class="pill" id="btnAuthClose">Đóng</button>
      </div>

      <form id="formLogin" class="auth-form">
        <div class="auth-row">
          <label>Email</label>
          <input type="email" placeholder="you@example.com">
        </div>
        <div class="auth-row">
          <label>Mật khẩu</label>
          <input type="password" placeholder="••••••••">
        </div>
        <div class="auth-actions">
          <button type="submit" class="pill">Đăng nhập</button>
          <button type="button" id="btnLoginGoogle" class="pill">Đăng nhập Google</button>
        </div>
      </form>

      <form id="formSignup" class="auth-form hide">
        <div class="auth-row">
          <label>Email</label>
          <input type="email" placeholder="you@example.com">
        </div>
        <div class="auth-actions">
          <button type="submit" class="pill">Gửi email xác minh</button>
        </div>
      </form>

      <form id="formReset" class="auth-form hide">
        <div class="auth-row">
          <label>Email</label>
          <input type="email" placeholder="you@example.com">
        </div>
        <div class="auth-actions">
          <button type="submit" class="pill">Gửi link đặt lại mật khẩu</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ======= FOOTER (nếu cần) ======= -->
  <footer id="mini_footer"></footer>

  <script>
  (function(){
    const N = (window.NINI = window.NINI || {});

    /* ---------- helpers ---------- */
    const $ = (s,r=document)=>r.querySelector(s);
    const $$ = (s,r=document)=>Array.from(r.querySelectorAll(s));

    const listPane = $('#listPane');
    const detailPane = $('#detailPane');

    /* ---------- router data demo ---------- */
    const DATA = {
      storybook: {
        title: 'Thư viện',
        items: [
          {id:'b1', title:'Bé NiNi & khu rừng'},
          {id:'b2', title:'Cuộc đua sắc màu'},
          {id:'b3', title:'Bạn mới của NiNi'}
        ]
      },
      video: {
        title:'Video',
        items:[
          {id:'v1', title:'Chuỗi 1 · Các mẹo tư duy nhanh'},
          {id:'v2', title:'Chuỗi 2 · Giải đố cùng NiNi'},
          {id:'v3', title:'Chuỗi 3 · Kể chuyện tương tác'}
        ]
      },
      game: {
        title:'Game',
        items:[
          {id:'g1', title:'Ghép hình'},
          {id:'g2', title:'Tìm điểm khác nhau'},
          {id:'g3', title:'Đường mê cung'}
        ]
      },
      shop:{
        title:'Shop',
        items:[
          {id:'s1', title:'Sticker NiNi'},
          {id:'s2', title:'Sổ tay giải đố'},
          {id:'s3', title:'Áo thun NiNi'}
        ]
      }
    };

    function renderList(route){
      const pack = DATA[route];
      if(!pack){ listPane.innerHTML=''; return; }
      listPane.innerHTML = `
        <h3>${pack.title}</h3>
        ${pack.items.map(i=>`
          <div class="item" data-id="${i.id}">${i.title}</div>
        `).join('')}
      `;
      // click item -> render detail
      $$('.item', listPane).forEach(el=>{
        el.addEventListener('click', ()=>{
          renderDetail(route, el.dataset.id);
        });
      });
    }
    function renderDetail(route, id){
      const pack = DATA[route];
      const item = pack?.items.find(x=>x.id===id) || null;
      if(!item){
        detailPane.innerHTML = `
          <h3>Chào mừng đến với NiNi — Funny</h3>
          <p>Dùng thanh bên trái để mở <strong>Storybook</strong>, <strong>Video</strong>, <strong>Game</strong>, <strong>Shop</strong>.</p>
        `;
        return;
      }
      detailPane.innerHTML = `
        <h3>${item.title}</h3>
        <p>Nội dung demo hiển thị ở đây (route: <code>${route}</code>, id: <code>${id}</code>).</p>
        <p>(Bạn thay phần này bằng viewer truyện, player video, game canvas, hoặc chi tiết sản phẩm.)</p>
      `;
    }

    /* ---------- header tabs -> detail pane ---------- */
    function renderStatic(section){
      const map = {
        home: `
          <h3>Giới thiệu</h3>
          <p>NiNi — Funny là sân chơi tư duy cho thiếu nhi.</p>
        `,
        rules: `
          <h3>Luật chơi</h3>
          <ul>
            <li>Chơi vui, tôn trọng bạn bè.</li>
            <li>Không spam, không nội dung độc hại.</li>
          </ul>
        `,
        forum: `
          <h3>Diễn đàn</h3>
          <p>Khu sinh hoạt cộng đồng. (nhúng thread hoặc link ngoài)</p>
        `,
        feedback: `
          <h3>Góp ý</h3>
          <p>Cho tụi mình biết bạn muốn gì hơn nhé!</p>
        `
      };
      listPane.innerHTML = '';
      detailPane.innerHTML = map[section] || map.home;
    }

    /* ---------- simple hash router ---------- */
    function goByHash(){
      const hash = location.hash.replace(/^#\//,'');
      if(!hash){ renderStatic('home'); return; }

      // sidebar routes
      if(['storybook','video','game','shop'].includes(hash)){
        renderList(hash);
        renderDetail(hash, null);
        return;
      }

      // header sections
      if(['home','rules','forum','feedback','profile'].includes(hash)){
        renderStatic(hash);
        return;
      }

      // storybook detail deeplink: #/storybook?id=b3
      const [path, qs] = hash.split('?');
      if(['storybook','video','game','shop'].includes(path)){
        const id = new URLSearchParams(qs || '').get('id');
        renderList(path);
        renderDetail(path, id);
        return;
      }

      renderStatic('home');
    }

    window.addEventListener('hashchange', goByHash);
    window.addEventListener('load', goByHash);

    /* ---------- nav bindings ---------- */
    $$('.tabs .pill').forEach(b=>{
      b.addEventListener('click', ()=> location.hash = b.dataset.nav );
    });
    $$('.sidebtn').forEach(b=>{
      b.addEventListener('click', ()=> location.hash = '#/' + b.dataset.route );
    });

    /* ---------- auth modal (đơn giản) ---------- */
    const modal = $('#authModal');
    const forms = {
      login: $('#formLogin'),
      signup: $('#formSignup'),
      reset: $('#formReset'),
    };

    function openModal(tab='login'){
      modal.classList.add('open');
      switchTab(tab);
    }
    function closeModal(){
      modal.classList.remove('open');
    }
    function switchTab(tab){
      Object.keys(forms).forEach(k => forms[k].classList.toggle('hide', k!==tab));
    }

    $('#btnAuthOpen').addEventListener('click', ()=> openModal('login'));
    $('#btnAuthClose').addEventListener('click', closeModal);
    $$('.auth-tabs [data-auth-tab]').forEach(b=>{
      b.addEventListener('click', ()=> switchTab(b.dataset.authTab));
    });

    // submit handlers (uỷ quyền sang NINI.fb nếu có)
    forms.login.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = $('input[type="email"]', forms.login).value.trim().toLowerCase();
      const password = $('input[type="password"]', forms.login).value;
      try{
        const fb = (N.fb)||{};
        const fn = fb.loginEmailPass || fb.loginEmailPassword;
        if(!fn) throw new Error('Thiếu NINI.fb.loginEmailPass');
        const user = await fn(email, password);
        updateAuthUI(user);
        closeModal();
      }catch(err){
        alert(err?.message || 'Đăng nhập thất bại');
      }
    });
    $('#btnLoginGoogle').addEventListener('click', async ()=>{
      try{
        const user = await N.fb?.loginGoogle?.();
        updateAuthUI(user); closeModal();
      }catch(err){ alert(err?.message||'Google Sign-in lỗi'); }
    });
    forms.signup.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = $('input[type="email"]', forms.signup).value.trim().toLowerCase();
      try{
        await N.fb?.registerEmailOnly?.(email);
        alert('Đã gửi email xác minh.');
        closeModal();
      }catch(err){ alert(err?.message || 'Đăng ký thất bại'); }
    });
    forms.reset.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = $('input[type="email"]', forms.reset).value.trim().toLowerCase();
      try{
        await N.fb?.resetPassword?.(email);
        alert('Đã gửi link đặt lại mật khẩu.');
        closeModal();
      }catch(err){ alert(err?.message || 'Gửi mail thất bại'); }
    });

    /* ---------- user avatar / signout ---------- */
    const userInfo = $('#userInfo');
    const btnAuth = $('#btnAuthOpen');
    const nick = $('#userNick');
    const ava = $('#btnProfile');
    const menu = $('#userMenu');

    ava.addEventListener('click', ()=>{
      menu.classList.toggle('open');
    });
    document.addEventListener('click', (e)=>{
      if(!e.target.closest('#userArea')) menu.classList.remove('open');
    });

    $('#btnSignOut').addEventListener('click', async ()=>{
      try{
        if(N.fb?.signOut) await N.fb.signOut();
        else if(N.fb?.logout) await N.fb.logout();
      }catch(e){}
      updateAuthUI(null);
    });

    function updateAuthUI(user){
      const showIn = !!user;
      btnAuth.classList.toggle('hide', showIn);
      userInfo.classList.toggle('hide', !showIn);
      if(showIn){
        const display = user.displayName || (user.email? user.email.split('@')[0] : 'NiNi');
        nick.textContent = display;
        const letter = display?.trim?.()[0]?.toUpperCase?.() || 'U';
        ava.style.setProperty('--ava-bg', user.photoURL ? `url("${user.photoURL}")`: 'none');
        ava.textContent = user.photoURL ? '' : letter;
      }else{
        ava.style.setProperty('--ava-bg', 'none'); ava.textContent='U';
        nick.textContent='NiNi';
      }
    }

    // theo dõi user từ SDK
    try{
      N.fb?.onUserChanged?.((u)=> updateAuthUI(u));
      if(N.fb?.currentUser){ try{ updateAuthUI(N.fb.currentUser()); }catch(_){} }
    }catch(_){}

  })();
  </script>
</body>
</html>
