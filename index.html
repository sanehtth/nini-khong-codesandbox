<!doctype html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NiNi — Funny</title>
  <link rel="icon" href="/public/assets/icons/logonini.svg" type="image/svg+xml" />

  <!-- Base styles (kính mờ) -->
  <style>
    :root{
      --bg: #101b10;
      --fg: #e9f6ea;
      --muted:#cfe6d1;
      --brand:#66e39d;
      --brand-2:#2ed573;
      --glass: rgba(255,255,255,.08);
      --glass-2: rgba(255,255,255,.12);
      --glass-3: rgba(255,255,255,.18);
      --blur: 12px;
      --radius: 16px;
      --shadow: 0 8px 30px rgba(0,0,0,.25);
      --card-w: 1100px;
      --bar-h: 60px;
      --nav-w: 76px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--fg); background:#0d1a0f url("/public/assets/bg/nini_home.webp") center/cover fixed no-repeat;
      font: 16px/1.5 system-ui,-apple-system,Segoe UI,Inter,Roboto;
    }
    a{color:inherit;text-decoration:none}
    .btn{
      appearance:none;border:1px solid transparent;background:var(--glass-2);
      color:var(--fg);padding:8px 14px;border-radius:12px;backdrop-filter: blur(var(--blur));
      box-shadow:var(--shadow);cursor:pointer;transition:.2s;
    }
    .btn:hover{background:var(--glass-3)}
    .chip{padding:6px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.15)}
    .glass{background:var(--glass);backdrop-filter: blur(var(--blur));border:1px solid rgba(255,255,255,.1)}
    .wrap{display:grid;grid-template-columns: var(--nav-w) 1fr;min-height:100dvh}

    /* Header (top) */
    .topbar{
      position:sticky;top:0;z-index:30;height:var(--bar-h);
      display:flex;align-items:center;gap:16px;
      padding:10px 16px;margin:12px; border-radius:999px;
      background:var(--glass-2); backdrop-filter: blur(var(--blur)); border:1px solid rgba(255,255,255,.12);
      box-shadow:var(--shadow);
    }
    .brand{display:flex;align-items:center;gap:10px;margin-right:auto}
    .brand__logo{width:36px;height:36px;border-radius:10px;background:#000 url('/public/assets/icons/logomini.svg') center/70% no-repeat}
    .brand__slogan{font-weight:600;opacity:.9}

    .topnav{display:flex;gap:10px}
    .topnav a{padding:8px 12px;border-radius:12px}
    .topnav a.active,.topnav a:hover{background:var(--glass-3)}

    /* Sidebar */
    .sidenav{
      position:sticky;top:calc(var(--bar-h) + 24px);height:calc(100dvh - var(--bar-h) - 48px);
      display:flex;flex-direction:column;align-items:center;gap:10px;padding:12px;
    }
    .snav-btn{
      width:52px;height:52px;border-radius:14px;display:grid;place-items:center;
      background:var(--glass-2);border:1px solid rgba(255,255,255,.12);cursor:pointer;transition:.2s;
    }
    .snav-btn:hover,.snav-btn.active{background:var(--glass-3)}
    .snav-btn span{font-size:22px}
    .snav-label{font-size:11px;opacity:.7;margin-top:4px}

    /* Stage (content) */
    .stage{
      padding: 0 16px 40px 8px;
    }
    .card{
      max-width:var(--card-w); margin:20px auto; border-radius:24px;padding:18px 20px;
      background:var(--glass);backdrop-filter: blur(var(--blur)); border:1px solid rgba(255,255,255,.12);
      box-shadow:var(--shadow);
    }
    .card h2{margin:6px 0 14px 0}
    .grid{
      display:grid;gap:14px;
      grid-template-columns: repeat(3,minmax(0,1fr));
    }
    .tile{
      border-radius:18px;padding:16px;background:var(--glass-2);border:1px solid rgba(255,255,255,.12);
      display:flex;flex-direction:column;gap:8px;
    }
    .tile h3{margin:0 0 6px 0}
    .tile p{margin:0 0 10px 0;opacity:.9}
    .tile .btn{align-self:flex-start}

    /* Avatar + menu */
    .userbox{display:flex;align-items:center;gap:8px}
    .avatar{
      width:36px;height:36px;border-radius:999px;display:grid;place-items:center;
      background:var(--glass-2);border:1px solid rgba(255,255,255,.12);cursor:pointer;position:relative;overflow:hidden
    }
    .avatar[data-letter]::after{content:attr(data-letter);font-weight:700}
    .menu{
      position:absolute;top:48px;right:0;min-width:180px;display:none;flex-direction:column;gap:6px;
      padding:10px;border-radius:12px;background:var(--glass-2);border:1px solid rgba(255,255,255,.12)
    }
    .menu a,.menu button{display:block;text-align:left}
    .avatar.open + .menu{display:flex}

    /* Modal auth (tận dụng style chung) */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:50}
    .modal.show{display:flex}
    .modal .sheet{width:min(720px,90vw);border-radius:20px;padding:18px;background:var(--glass);border:1px solid rgba(255,255,255,.15)}
    .modal .tabs{display:flex;gap:8px;margin-bottom:12px}
    .row{display:flex;gap:10px;align-items:center}
    .row > input{flex:1;border-radius:12px;padding:10px 12px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);color:var(--fg)}
    .note{opacity:.8;font-size:13px}
    @media (max-width: 880px){
      .grid{grid-template-columns: 1fr}
      .topbar{border-radius:18px}
      .sidenav{top:unset;height:auto;position:static;flex-direction:row;justify-content:center}
      .wrap{grid-template-columns: 1fr}
    }
  </style>
</head>
<body>

  <!-- ======= TOP BAR ======= -->
  <div class="topbar">
    <div class="brand">
      <div class="brand__logo"></div>
      <div class="brand__slogan">chơi mê ly, bứt phá tư duy</div>
    </div>

    <nav class="topnav" id="topnav">
      <a href="#/about"   data-top>Giới thiệu</a>
      <a href="#/rules"   data-top>Luật chơi</a>
      <a href="#/forum"   data-top>Diễn đàn</a>
      <a href="#/feedback" data-top>Góp ý</a>
    </nav>

    <!-- user -->
    <div class="userbox">
      <button id="btnAuthOpen" class="btn chip" type="button">Đăng nhập</button>

      <button id="btnAvatar" class="avatar" type="button" title="Tài khoản" data-letter="N"></button>
      <div id="userMenu" class="menu">
        <a class="btn" href="/profile.html">Hồ sơ</a>
        <button id="btnSignOut" class="btn" type="button">Đăng xuất</button>
      </div>
    </div>
  </div>

  <!-- ======= LAYOUT ======= -->
  <div class="wrap">
    <!-- SIDEBAR -->
    <aside class="sidenav" id="sidenav">
      <a class="snav-btn" href="#/storybook" data-side title="Storybook"><span>📚</span><div class="snav-label">Storybook</div></a>
      <a class="snav-btn" href="#/video"     data-side title="Video">     <span>🎬</span><div class="snav-label">Video</div></a>
      <a class="snav-btn" href="#/game"      data-side title="Game">      <span>🎮</span><div class="snav-label">Game</div></a>
      <a class="snav-btn" href="#/shop"      data-side title="Shop">      <span>🛍️</span><div class="snav-label">Shop</div></a>
    </aside>

    <!-- STAGE -->
    <main class="stage">
      <section id="stageCard" class="card">
        <!-- Nội dung sẽ render bằng JS -->
      </section>
    </main>
  </div>

  <!-- ======= AUTH MODAL (tận dụng style chung) ======= -->
  <div id="authModal" class="modal" aria-hidden="true">
    <div class="sheet">
      <div class="tabs">
        <button class="btn chip" data-auth-tab="login">Đăng nhập</button>
        <button class="btn chip" data-auth-tab="signup">Đăng ký</button>
        <button class="btn chip" data-auth-tab="reset">Quên mật khẩu</button>
        <button id="authClose" class="btn" style="margin-left:auto">Đóng</button>
      </div>

      <!-- login -->
      <form id="formLogin" class="pane" data-pane="login">
        <div class="row"><input type="email" placeholder="Email" /></div>
        <div class="row"><input type="password" placeholder="Mật khẩu" /></div>
        <div class="row"><button class="btn" type="submit">Đăng nhập</button>
          <button class="btn" type="button" id="btnGoogle">Đăng nhập Google</button></div>
        <div class="note">Mẹo: bạn có thể bật VPN nếu mạng chặn Firebase auth API.</div>
      </form>

      <!-- signup (email verify) -->
      <form id="formSignup" class="pane" data-pane="signup" style="display:none">
        <div class="row"><input type="email" placeholder="Email" /></div>
        <div class="row"><button class="btn" type="submit">Gửi mail xác minh</button></div>
        <div class="note">Hệ thống gửi email xác minh đăng ký.</div>
      </form>

      <!-- reset -->
      <form id="formReset" class="pane" data-pane="reset" style="display:none">
        <div class="row"><input type="email" placeholder="Email" /></div>
        <div class="row"><button class="btn" type="submit">Gửi link đặt lại mật khẩu</button></div>
      </form>
    </div>
  </div>

  <!-- ======= PAGE SCRIPTS ======= -->
  <!-- Firebase wrapper + auth glue của bạn -->
  <script type="module" src="/public/js/nini-fb.mjs"></script>
  <script src="/test/js/auth-glue.js" defer></script>

  <script>
  (function(){
    const N = (window.NINI = window.NINI || {});
    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => r.querySelectorAll(s);

    // ====== Router nội bộ (hash) ======
    const routes = {
      '/storybook': renderStory,
      '/video':     renderVideo,
      '/game':      renderGame,
      '/shop':      renderShop,
      '/about':     renderAbout,
      '/rules':     renderRules,
      '/forum':     renderForum,
      '/feedback':  renderFeedback,
    };

    function setActiveLinks() {
      const hash = location.hash.replace('#','') || '/storybook';
      // top
      $$('#topnav a').forEach(a=> a.classList.toggle('active', a.getAttribute('href').slice(1)===hash));
      // side
      $$('#sidenav [data-side]').forEach(a=> a.classList.toggle('active', a.getAttribute('href').slice(1)===hash));
    }

    function render() {
      const key = location.hash.replace('#','') || '/storybook';
      setActiveLinks();
      const fn = routes[key] || renderStory;
      fn();
    }
    window.addEventListener('hashchange', render);
    document.addEventListener('DOMContentLoaded', render);

    // ====== Content renderers ======
    const card = $('#stageCard');

    function renderStory(){
      card.innerHTML = `
        <h2>Storybook</h2>
        <div class="grid">
          ${tile('Bí mật khu rừng','Truyện tranh tương tác ngắn.')}
          ${tile('Bạn NiNi & chiếc lá','Câu chuyện về lòng dũng cảm.')}
          ${tile('Hộp nhạc kỳ diệu','Khám phá cảm xúc qua âm nhạc.')}
        </div>`;
    }
    function renderVideo(){
      card.innerHTML = `
        <h2>Video</h2>
        <div class="grid">
          ${tile('NiNi Shorts','Video ngắn truyền cảm hứng.')}
          ${tile('Học mà vui','Kênh chia sẻ mẹo tư duy.')}
          ${tile('Behind the scenes','Hậu trường làm game & truyện.')}
        </div>`;
    }
    function renderGame(){
      card.innerHTML = `
        <h2>Game</h2>
        <div class="grid">
          ${tile('100 thử thách tư duy','Mini puzzle luyện não.')}
          ${tile('MeoMaze','Mê cung mèo tinh nghịch.')}
          ${tile('ColorMatch','Ghép màu phản xạ nhanh.')}
        </div>`;
    }
    function renderShop(){
      card.innerHTML = `
        <h2>Shop</h2>
        <div class="grid">
          ${tile('Sticker NiNi','Bộ 20 sticker dễ thương.')}
          ${tile('Sổ tay giải đố','100 thử thách tư duy.')}
          ${tile('Áo thun NiNi','Cotton mềm, unisex.')}
        </div>`;
    }

    function renderAbout(){ card.innerHTML = `<h2>Giới thiệu</h2><p>NiNi — Funny: chơi mê ly, bứt phá tư duy.</p>`; }
    function renderRules(){ card.innerHTML = `<h2>Luật chơi</h2><p>Luật đơn giản, công bằng, đề cao sáng tạo.</p>`; }
    function renderForum(){ card.innerHTML = `<h2>Diễn đàn</h2><p>Nơi chia sẻ mẹo & kinh nghiệm hay.</p>`; }
    function renderFeedback(){ card.innerHTML = `<h2>Góp ý</h2><p>Gửi ý tưởng, góp ý để NiNi tốt hơn nhé!</p>`; }

    function tile(title, desc){
      return `
        <div class="tile">
          <h3>${title}</h3>
          <p>${desc}</p>
          <button class="btn">Xem</button>
        </div>`;
    }

    // ====== Auth modal (mở/đóng + đổi tab) ======
    const modal = $('#authModal');
    const btnOpen = $('#btnAuthOpen');
    const btnClose = $('#authClose');

    btnOpen.addEventListener('click', () => openModal('login'));
    btnClose.addEventListener('click', () => closeModal());

    document.addEventListener('click', (e)=>{
      const b = e.target.closest('[data-auth-tab]');
      if (!b) return;
      const tab = b.getAttribute('data-auth-tab');
      switchPane(tab);
    });

    function openModal(tab='login'){
      modal.classList.add('show');
      modal.setAttribute('aria-hidden','false');
      switchPane(tab);
    }
    function closeModal(){
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden','true');
    }
    function switchPane(name){
      $$('.pane').forEach(p => p.style.display = (p.dataset.pane===name?'block':'none'));
    }

    // ====== Avatar menu + đồng bộ trạng thái ======
    const ava = $('#btnAvatar');
    const menu = $('#userMenu');
    const btnSignOut = $('#btnSignOut');

    ava.addEventListener('click', () => {
      // nếu guest -> mở modal; nếu đã login -> toggle menu
      const u = N.fb?.currentUser?.();
      if (!u){ openModal('login'); return; }
      ava.classList.toggle('open');
    });
    document.addEventListener('click', (e)=>{
      if (!e.target.closest('#btnAvatar')) ava.classList.remove('open');
    });

    btnSignOut.addEventListener('click', async ()=>{
      try{ await N.fb?.signOut?.(); }catch(_){}
      ava.classList.remove('open');
    });

    function syncUser(u){
      const guest = !u;
      $('#btnAuthOpen').style.display = guest ? 'inline-flex' : 'none';
      ava.style.display = guest ? 'none' : 'grid';
      if (u){
        const display = u.displayName || (u.email ? u.email.split('@')[0] : 'NiNi');
        const letter = (display.trim()[0]||'N').toUpperCase();
        ava.setAttribute('data-letter', letter);
        if (u.photoURL){
          ava.style.backgroundImage = `url("${u.photoURL}")`;
          ava.style.backgroundSize = 'cover';
        } else {
          ava.style.backgroundImage = '';
        }
      } else {
        ava.removeAttribute('data-letter');
        ava.style.backgroundImage = '';
      }
    }
    // theo dõi Firebase auth
    try{
      N.fb?.onUserChanged?.(syncUser);
      const u = N.fb?.currentUser?.(); if (u) syncUser(u); else syncUser(null);
    }catch(_){}
  })();
  </script>

</body>
</html>
