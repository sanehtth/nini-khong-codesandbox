<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NiNi — Hồ sơ</title>

  <link rel="stylesheet" href="/public/theme/nini-base.css" />
  <script defer src="/public/js/theme-boot.js"></script>
</head>
<body class="spring">
  <!-- Header -->
  <div id="nini_header"></div>

  <!-- Nội dung hồ sơ -->
  <main class="glass-card-container">
    <section class="profile two-col">
      <!-- Trái: avatar + form -->
      <div class="card profile-left">
        <div class="row avatar-row">
          <img id="pfAvatar" class="avatar-xl" src="/public/assets/avatar/NINI.webp" alt="avatar" />
          <div class="btns">
            <button class="btn" id="btnUpload">Tải ảnh mới</button>
            <button class="btn" id="btnDefault">Về mặc định</button>
          </div>
        </div>

        <div class="form">
          <label>Email</label>
          <input id="pfEmail" type="email" placeholder="you@example.com" disabled />

          <label>Tên hiển thị</label>
          <input id="pfDisplayName" type="text" placeholder="Bé NiNi" />

          <label>Ngày sinh</label>
          <input id="pfDob" type="text" placeholder="dd/mm/yyyy" />

          <label>Tỉnh/Thành</label>
          <input id="pfCity" type="text" placeholder="Hà Nội / TPHCM ..." />

          <label>Lớp/Khối</label>
          <input id="pfGrade" type="text" placeholder="Lớp 2, Lớp 3..." />

          <label>Phụ huynh (tuỳ chọn)</label>
          <input id="pfParent" type="text" placeholder="Tên phụ huynh" />

          <label>Số điện thoại</label>
          <input id="pfPhone" type="text" placeholder="09xxxxxxx" />

          <div class="row actions">
            <button class="btn" id="btnSave">Lưu hồ sơ</button>
            <button class="btn" id="btnPwd">Đổi / Thêm mật khẩu</button>
            <button class="btn" id="btnSync">Đồng bộ lại</button>
          </div>
        </div>
      </div>

      <!-- Phải: Thành tích -->
      <aside class="card profile-right">
        <h3>Thành tích</h3>
        <div class="stat"><b>XP</b><span id="pfXp">0</span></div>
        <div class="stat"><b>Xu</b><span id="pfCoin">0</span></div>

        <p class="hint">
          Rương mở cho XP/Xu ngẫu nhiên (local & cloud).
          Bạn có thể đồng bộ với tài khoản trò chơi.
        </p>

        <button class="btn" id="btnCloudSync">Đồng bộ lại</button>
      </aside>
    </section>
  </main>

  <footer class="footer-bar">
    <nav class="footer-nav">
      <a class="chip" href="#/about">Giới thiệu</a>
      <a class="chip" href="#/rules.html">Luật chơi</a>
      <a class="chip" href="#/forum">Diễn đàn</a>
      <a class="chip" href="#/feedback.html">Góp ý</a>
    </nav>
  </footer>

  <!-- Firebase + Header -->
  <script type="module" src="/public/js/nini-fb.js"></script>
  <script type="module" src="/public/js/nini-header.js"></script>

  <!-- Hook hồ sơ (đọc user từ Firebase) -->
  <script>
    (function () {
      const KEY_SEASON = 'nini.season';

      document.addEventListener('DOMContentLoaded', () => {
        if (window.NINI && NINI.header) NINI.header.mount('#nini_header');

        // giữ nền theo mùa đã chọn ở trang ngoài
        const season = localStorage.getItem(KEY_SEASON) || 'spring';
        document.body.classList.remove('spring','summer','autumn','winter');
        document.body.classList.add(season);

        // nạp user
        if (NINI?.fb) {
          NINI.fb.onUserChanged(user => {
            if (!user) {
              // chưa đăng nhập => mở modal
              alert('Bạn cần đăng nhập để chỉnh sửa hồ sơ.');
              const open = () => document.querySelector('#btnAuthOpen')?.click();
              setTimeout(open, 50);
              return;
            }
            fillUser(user);
          });
        }

        // sự kiện giả lập lưu/sync
        document.getElementById('btnSave').onclick = () => alert('Đã lưu hồ sơ (mock).');
        document.getElementById('btnPwd').onclick  = () => alert('Tính năng đổi mật khẩu có thể dùng trong tab "Quên mật khẩu" để đặt lại.');
        document.getElementById('btnSync').onclick = () => alert('Đã đồng bộ (mock).');
        document.getElementById('btnCloudSync').onclick = () => alert('Đã đồng bộ cloud (mock).');
      });

      function fillUser(u) {
        document.getElementById('pfEmail').value       = u.email || '';
        document.getElementById('pfDisplayName').value = u.displayName || 'Bé NiNi';
        document.getElementById('pfAvatar').src        = u.photoURL || '/public/assets/avatar/NINI.webp';
      }
    })();
  </script>
</body>
</html>
