<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NiNi — Hồ sơ</title>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/public/assets/icons/logonini.svg" />

  <!-- Theme mới -->
  <link rel="stylesheet" href="/public/theme/nini-base.css" />
</head>
<body class="spring">

  <!-- Header mount point -->
  <div id="nini__header"></div>

  <!-- Khung nội dung -->
  <div id="frame" class="stage">
    <main class="page">
      <section class="glass page-body">
        <!-- Khối hồ sơ -->
        <div class="profile">
          <aside class="profile__avatar">
            <img id="avatar" src="/public/assets/avatar/NV.webp" alt="avatar" class="avatar" />
            <div class="profile__avatar-actions">
              <button id="btnUpload" class="btn">Tải ảnh mới</button>
              <button id="btnReset" class="btn" title="Về mặc định">Về mặc định</button>
            </div>
          </aside>

          <div class="profile__form">
            <label>Email
              <input id="fEmail" type="email" placeholder="you@example.com" disabled />
            </label>
            <label>Tên hiển thị
              <input id="fDisplay" type="text" placeholder="Bé NiNi" />
            </label>
            <label>Ngày sinh
              <input id="fDob" type="text" placeholder="dd/mm/yyyy" />
            </label>
            <label>Tỉnh/Thành
              <input id="fCity" type="text" placeholder="Hà Nội / TPHCM ..." />
            </label>
            <label>Lớp/Khối
              <input id="fClass" type="text" placeholder="Lớp 2, Lớp 3..." />
            </label>
            <label>Phụ huynh (tuỳ chọn)
              <input id="fParent" type="text" placeholder="Tên phụ huynh" />
            </label>
            <label>Số điện thoại
              <input id="fPhone" type="text" placeholder="09xxxxxxx" />
            </label>

            <div class="profile__actions">
              <button id="btnSave" class="btn">Lưu hồ sơ</button>
              <button id="btnPwd" class="btn">Đổi / Thêm mật khẩu</button>
              <button id="btnSync" class="btn">Đồng bộ lại</button>
            </div>
          </div>

          <!-- Thành tích (bên phải) -->
          <aside class="profile__stats glass">
            <h3>Thành tích</h3>
            <div class="stats">
              <div class="stat"><span class="label">XP</span><span id="statXp">0</span></div>
              <div class="stat"><span class="label">Xu</span><span id="statCoin">0</span></div>
            </div>
            <div class="row">
              <button id="btnSyncCloud" class="btn">Đồng bộ lại</button>
            </div>
          </aside>
        </div>
      </section>
    </main>
  </div>

  <!-- Footer chips -->
  <footer class="footer-bar">
    <nav class="chips" aria-label="Liên kết nhanh">
      <a class="chip" href="/about.html">Giới thiệu</a>
      <a class="chip" href="/rules.html">Luật chơi</a>
      <a class="chip" href="/forum.html">Diễn đàn</a>
      <a class="chip" href="/feedback.html">Góp ý</a>
    </nav>
  </footer>

  <!-- ===== JS theo thứ tự ===== -->
  <script src="/public/js/nini-fb.js"></script>
  <script src="/public/js/nini-header.js"></script>

  <script>
    // Mount header
    document.addEventListener('DOMContentLoaded', () => {
      const routes = {
        home:   '/#/home',
        spring: '/#/spring',
        summer: '/#/summer',
        autumn: '/#/autumn',
        winter: '/#/winter',
        admin:  '/admin/index.html',
        profile:'/profile.html'
      };

      window.NINI?.header?.mount?.('#nini__header', {
        defaultSeason: 'auto',
        routes
      });
    });

    // ===== Demo binding dữ liệu hồ sơ (đợi fb sẵn sàng) =====
    function bindProfile(u) {
      // u có thể null nếu chưa đăng nhập
      document.getElementById('fEmail').value = u?.email || '';
      document.getElementById('fDisplay').value = u?.displayName || '';
      // Tuỳ bạn load thêm hồ sơ từ DB → fill vào các field còn lại
    }

    // Lắng nghe trạng thái đăng nhập: dùng event fb ready + subscribe
    (function waitAndSub() {
      if (window.NINI?.fb?.onUserChanged) {
        window.NINI.fb.onUserChanged(bindProfile);
      } else {
        window.addEventListener('nini:fb:ready', () => {
          window.NINI?.fb?.onUserChanged?.(bindProfile);
        }, { once: true });
      }
    })();

    // Actions (ví dụ)
    document.getElementById('btnPwd').addEventListener('click', () => {
      // mở modal đổi mật khẩu từ header
      document.querySelector('[data-tab="login"]')?.click?.(); // nếu bạn có kích hoạt modal từ header
    });
  </script>

  <noscript>Vui lòng bật JavaScript để dùng trang NiNi-funny.</noscript>
</body>
</html>
