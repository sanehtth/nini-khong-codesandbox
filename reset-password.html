<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Đặt lại mật khẩu — NiNi</title>
  <link rel="icon" type="image/webp" href="/public/assets/icons/logonini.webp" />
  <meta name="robots" content="noindex, follow" />

  <style>
    :root{
      --card-bg: rgba(255,255,255,.85);
      --card-shadow: 0 10px 30px rgba(0,0,0,.15);
      --radius: 16px;
      --green: #2f6e3f;
      --green-2: #21512d;
      --text: #1c2024;
      --note-ok: #0f5132;
      --note-err:#7f1d1d;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font: 16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;
      background: #e6f1e9 url("/public/assets/bg/nini_home.webp") center/cover fixed no-repeat;
    }

    /* Header giống index: logo không nền/viền, slogan màu đồng bộ */
    .site-head{
      position: fixed; inset: 16px auto auto 16px;
      display:flex; align-items:center; gap:10px;
      z-index:20; pointer-events:none;
    }
    .site-head .brand{pointer-events:auto; text-decoration:none; line-height:0}
    .brand__img{height:34px; width:auto; display:block; background:transparent; border:0}
    .slogan{
      font-weight:600; font-size:14px; letter-spacing:.2px;
      color:#F1E6B6; text-shadow:0 1px 2px rgba(0,0,0,.25); user-select:none;
    }

    /* khối form ở giữa màn hình */
    .wrap{
      min-height:100%;
      display:grid;
      place-items:center;
      padding: 80px 16px;
      backdrop-filter: blur(0px);
    }
    .card{
      width: min(560px, 92vw);
      background: var(--card-bg);
      box-shadow: var(--card-shadow);
      border-radius: var(--radius);
      padding: 28px 24px 22px;
      transition: box-shadow .2s ease;
    }
    .title{
      margin:0 0 6px;
      font-weight:800; font-size: clamp(18px, 2.5vw, 22px);
      color:var(--green-2);
    }
    .desc{margin:0 0 18px; color:#50615a; font-size:14px}
    .row{display:flex; gap:10px; align-items:center}
    .input{
      flex:1 1 auto;
      height:42px; padding:0 12px;
      border-radius: 10px; border:1px solid #ced7d2;
      outline:none; background:#fff;
    }
    .input:focus{border-color:#9fc5b0; box-shadow:0 0 0 3px rgba(47,110,63,.12)}
    .btn{
      height:42px; padding:0 14px; border-radius: 10px;
      border:0; cursor:pointer; font-weight:700;
      background: var(--green); color:#fff;
    }
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .links{
      margin-top:10px; display:flex; gap:16px; align-items:center; justify-content:flex-end
    }
    .a{color:var(--green-2); text-decoration:none; font-weight:600}
    .note{margin-top:12px; font-size:14px}
    .note.ok{color:var(--note-ok)}
    .note.err{color:var(--note-err)}

    @media (max-width:480px){
      .brand__img{height:30px}
      .slogan{font-size:13px}
      .card{padding:22px 18px}
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="site-head">
    <a href="/#home" class="brand" aria-label="NiNi — Funny">
      <img src="/public/assets/icons/logo_text.webp" alt="NiNi — Funny" class="brand__img" />
    </a>
    <span class="slogan">Chơi mê lý, bứt phá tư duy</span>
  </header>

  <!-- Form -->
  <main class="wrap">
    <section class="card" aria-live="polite">
      <h1 class="title">Đặt lại mật khẩu</h1>
      <p class="desc">Nhập mật khẩu mới cho tài khoản của bạn.</p>

      <div class="row">
        <input id="pwd" type="password" class="input" placeholder="Mật khẩu mới (≥ 8 ký tự)" autocomplete="new-password" />
        <button id="btn" class="btn">Đổi mật khẩu</button>
      </div>

      <div class="links">
        <a class="a" href="/#home">Về trang chủ</a>
      </div>

      <p id="msg" class="note"></p>
    </section>
  </main>

  <!-- Firebase + logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, confirmPasswordReset } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    // === Firebase config (đúng project của bạn) ===
    const firebaseConfig = {
      apiKey: "AIzaSyBdaMS7aI03wHLhi1Md2QDitJFkA61IYUU",
      authDomain: "nini-8f3d4.firebaseapp.com",
      projectId: "nini-8f3d4",
      storageBucket: "nini-8f3d4.firebasestorage.app",
      messagingSenderId: "991701821645",
      appId: "1:991701821645:web:fb21c357562c6c801da184"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // --- helpers ---
    const $ = (id)=>document.getElementById(id);
    const btn = $("btn");
    const pwd = $("pwd");
    const msg = $("msg");
    const setNote = (t, ok=true)=>{ msg.textContent=t||""; msg.className = "note " + (ok?"ok":"err"); };

    // Lấy oobCode từ URL (Firebase gửi trong link email)
    const sp = new URLSearchParams(location.search);
    const oobCode = sp.get("oobCode");

    if (!oobCode) {
      setNote("Thiếu mã xác thực (oobCode). Vui lòng mở lại đường dẫn từ email.", false);
      btn.disabled = true;
    }

    btn.addEventListener("click", async ()=>{
      const p = (pwd.value||"").trim();
      if (p.length < 8) { setNote("Mật khẩu phải ≥ 8 ký tự.", false); pwd.focus(); return; }

      btn.disabled = true;
      setNote("Đang đổi mật khẩu, vui lòng đợi...");

      try{
        await confirmPasswordReset(auth, oobCode, p);
        setNote("Đổi mật khẩu thành công. Bạn có thể đăng nhập lại.", true);
        setTimeout(()=> location.href = "/#home", 1200);
      }catch(e){
        setNote(e?.code || e?.message || "Liên kết không hợp lệ hoặc đã hết hạn.", false);
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>

