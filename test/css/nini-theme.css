/* ==========================================================================
   NiNi — Funny: THEME CSS (gộp base.css + stage.css)
   - Reset & variables
   - Background
   - Helpers
   - Glass/Panel
   - Header (logo + slogan + tabs)
   - Stage layout (sidebar + storybook + reader)
   - Buttons, Badge
   - Modal Auth
   - Responsive
   - Safeguards
   ========================================================================== */

/* ---------------------------- 1) Reset ---------------------------------- */
*,
*::before,
*::after { box-sizing: border-box; }

html, body { height: 100%; }

html{
  -webkit-text-size-adjust:100%;
  text-size-adjust:100%;
}

body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
               Helvetica Neue, Arial, "Noto Sans", "Liberation Sans", sans-serif,
               "Apple Color Emoji","Segoe UI Emoji";
  line-height:1.5;
  color:#0f172a;
  background:#0b1f12;                /* fallback nếu mất ảnh nền */
}

/* ---------------------------- 2) Variables ------------------------------ */
:root{
  /* Màu thương hiệu & chữ */
  --brand:#22c55e;
  --brand-2:#16a34a;
  --ink:#0f172a;
  --muted:#475569;
  --light:#f8fafc;

  /* Kính & panel */
  --glass:rgba(255,255,255,.26);
  --glass-bd:rgba(255,255,255,.25);
  --panel:rgba(255,255,255,.10);
  --shadow:0 10px 30px rgba(0,0,0,.25);
  --radius-lg:24px;
  --radius-md:14px;
  --radius-sm:10px;

  /* Nav pill */
  --pill-bg:#0b2a17cc;
  --pill-active:#14603a;
  --pill-text:#e6f6ed;

  /* Buttons */
  --btn:#10b981;        /* emerald */
  --btn-active:#0ea5e9; /* sky */
}

/* ---------------------------- 3) Background ----------------------------- */
/* Ảnh nền rừng */
body::before{
  content:"";
  position:fixed; inset:0; z-index:-2;
  background:url("/public/assets/bg/nini_home.webp") center/cover no-repeat;
  filter:saturate(1.05) contrast(1.02);
}

/* Lớp mờ gradient giúp chữ nổi hơn */
body::after{
  content:"";
  position:fixed; inset:0; z-index:-1;
  background:
    radial-gradient(60% 60% at 50% 20%, rgba(255,255,255,.20) 0%, rgba(255,255,255,0) 40%),
    linear-gradient(180deg, rgba(0,0,0,.14), rgba(0,0,0,.25));
}

/* ---------------------------- 4) Helpers -------------------------------- */
.container{ width:min(1200px,92vw); margin:0 auto; }
.hidden{ display:none !important; }
.muted{ color:var(--muted); }
.center{ text-align:center; }

/* ---------------------------- 5) Glass / Panel -------------------------- */
/* (DUY NHẤT) Định nghĩa kính chung cho toàn site */
.glass{
  background:var(--glass);
  backdrop-filter:blur(16px) saturate(160%);
  -webkit-backdrop-filter:blur(16px) saturate(160%);
  border:1px solid var(--glass-bd);
  border-radius:var(--radius-lg);
  box-shadow:0 8px 20px rgba(0,0,0,.10);
  color:var(--ink);
}

.panel{
  background:var(--panel);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
  border:1px solid var(--glass-bd);
  border-radius:var(--radius-lg);
  box-shadow:var(--shadow);
}

/* ---------------------------- 6) Header --------------------------------- */
#nini_header{ position:sticky; top:0; z-index:50; }

.nini-header{
  display:grid;
  grid-template-columns:1fr auto auto;
  align-items:center;
  gap:16px;
  margin:10px auto;
  padding:10px 14px;
  max-width:1200px;
  border-radius:18px;
  background:rgba(255,255,255,.22);
  backdrop-filter:blur(14px) saturate(150%);
  -webkit-backdrop-filter:blur(14px) saturate(150%);
  border:1px solid rgba(255,255,255,.28);
}

/* logo + slogan */
.nh-left .brand{
  display:flex; gap:10px; align-items:center;
  text-decoration:none; color:inherit;
}
.brand-logo{ width:36px; height:36px; display:block; }
.brand-text{ line-height:1.1; display:grid; }
.brand-name{ font-size:14px; }
.brand-slogan{ font-size:12px; opacity:.8; }

/* nav pills giữa header */
.nh-nav{ display:flex; gap:10px; align-items:center; }
.nh-nav .pill{
  display:inline-flex; align-items:center; justify-content:center;
  padding:8px 12px; border-radius:999px;
  text-decoration:none;
  border:1px solid rgba(255,255,255,.35);
  background:rgba(255,255,255,.55);
  font-weight:700; font-size:13px; color:#0f172a;
  transition:transform .12s ease, background .12s ease;
}
.nh-nav .pill:hover{ transform:translateY(-1px); }
.nh-nav .pill.active{
  background:rgba(255,255,255,.9);
  border-color:rgba(255,255,255,.7);
}

/* auth dock bên phải */
.nh-right{ display:flex; align-items:center; gap:8px; }

/* ---------------------------- 7) Stage Layout --------------------------- */
/* Grid tổng: Sidebar | Middle (Storybook) | Main (Reader/khác) */
.nini-layout{
  max-width:1200px;
  margin:24px auto 48px;
  padding:0 16px;
  display:grid;
  gap:24px;
  grid-template-columns:88px 320px 1fr;
}

/* Sidebar: chỉ icon + tooltip */
.nini-side{
  padding:14px;
  background:rgba(20,83,45,.55);
  color:#f0fdf4;
  border:1px solid rgba(255,255,255,.20);
  border-radius:var(--radius-lg);
  z-index:10; /* tránh tooltip bị che */
}
.side-icons{ display:flex; flex-direction:column; gap:14px; padding:6px 0; }
@media (min-width:1200px){ .side-icons{ gap:16px; } }

.icon-btn{
  position:relative; display:grid; place-items:center;
  padding:10px; text-decoration:none;
}
.icon-btn .icon{
  width:44px; height:44px; border-radius:12px;
  display:grid; place-items:center;
  background:rgba(255,255,255,.22);
  border:1px solid var(--glass-bd);
}
.icon-btn img{ width:28px; height:28px; object-fit:contain; display:block; }

/* Tooltip */
.icon-btn .lbl{
  position:absolute; left:calc(100% + 10px); top:50%;
  transform:translateY(-50%) translateX(-6px);
  opacity:0; visibility:hidden; pointer-events:none;
  white-space:nowrap; z-index:50;
  background:rgba(17,24,39,.92); color:#fff;
  font-size:12px; font-weight:700;
  padding:6px 10px; border-radius:10px;
  box-shadow:0 6px 18px rgba(0,0,0,.25);
  border:1px solid rgba(255,255,255,.15);
}
.icon-btn .lbl::after{
  content:""; position:absolute; right:100%; top:50%;
  transform:translateY(-50%);
  border:6px solid transparent; border-right-color:rgba(17,24,39,.92);
}
.icon-btn:hover .lbl,
.icon-btn:focus-visible .lbl{
  opacity:1; visibility:visible; transform:translateY(-50%);
  transition:opacity .15s ease, transform .15s ease;
}
@media (max-width:900px){ .icon-btn .lbl{ display:none; } }

/* Middle: Storybook list */
.nini-middle{ display:flex; flex-direction:column; gap:24px; }
.storybook.panel{ padding:18px; }
.storybook .sb-head{
  display:flex; align-items:center; gap:8px;
  margin-bottom:10px; font-weight:800; color:var(--ink);
}
.lib-grid{ display:grid; gap:14px; grid-template-columns:1fr; }
.lib-card{
  display:flex; gap:12px; align-items:center; cursor:pointer;
  padding:10px; border-radius:16px;
  background:rgba(255,255,255,.35);
  border:1px solid var(--glass-bd);
  backdrop-filter:blur(12px);
  transition:transform .12s ease, box-shadow .12s ease;
}
.lib-card:hover{ transform:translateY(-1px); box-shadow:0 10px 24px rgba(0,0,0,.08); }
.lib-cover{ width:64px; height:64px; border-radius:12px; overflow:hidden; background:#f1f5f9; flex:0 0 auto; }
.lib-cover img{ width:100%; height:100%; object-fit:cover; display:block; }
.lib-title{ margin:0 0 4px; font:800 16px/1.1 system-ui, sans-serif; color:var(--ink); }
.lib-author{ margin:0; font:13px/1.35 system-ui, sans-serif; color:#334155; }

/* Main: Reader (trình đọc) */
.nini-main{ display:flex; flex-direction:column; gap:24px; }
.panel{ padding:18px; }

.panel-head{ display:flex; align-items:center; justify-content:space-between; margin:4px 2px 12px; }
.panel-head h2{ margin:0; font-size:18px; color:var(--ink); }

.reader-controls{ display:flex; gap:8px; align-items:center; }
.btn.small{
  padding:6px 10px; border-radius:10px; border:1px solid var(--glass-bd);
  background:rgba(255,255,255,.65); font-weight:700; cursor:pointer;
}
.btn.small.active{ background:rgba(255,255,255,.85); }

/* Ảnh 16:9 chuẩn */
.reader-stage{ display:grid; gap:12px; }
.reader-image{
  width:100%; aspect-ratio:16 / 9;
  border-radius:14px; overflow:hidden; background:rgba(0,0,0,.06);
}
.reader-image > img#reader_img{
  display:block; width:100%; height:100%; object-fit:cover;
}

.reader-text{
  font-size:16px; line-height:1.6; color:var(--ink);
  background:rgba(255,255,255,.55);
  border:1px solid var(--glass-bd);
  border-radius:14px; padding:12px;
}
.reader-nav{ display:flex; align-items:center; justify-content:space-between; margin-top:8px; }
.page-indicator{ font-weight:800; color:var(--ink); }

/* ---------------------------- 8) Buttons / Badge ------------------------ */
.btn{
  appearance:none; border:0;
  padding:10px 14px; border-radius:12px;
  background:var(--btn); color:#052e1a;
  font-weight:800; cursor:pointer;
  transition:transform .12s ease, background .12s ease, box-shadow .12s ease;
  box-shadow:0 6px 18px rgba(16,185,129,.35);
}
.btn:hover{ transform:translateY(-1px); }
.btn:active{ transform:translateY(0); background:var(--btn-active); color:#fff; }
.btn--ghost{
  background:transparent; color:#e2fbe8;
  border:1px solid rgba(255,255,255,.25); box-shadow:none;
}
.btn--sm{ padding:6px 10px; border-radius:10px; font-weight:700; }

.badge{
  display:inline-block; padding:3px 8px; border-radius:999px;
  background:rgba(255,255,255,.14); color:#eafff7; font-size:.78rem;
  border:1px solid rgba(255,255,255,.22);
}

/* ---------------------------- 9) Modal Auth ----------------------------- */
.modal{ position:fixed; inset:0; display:none; place-items:center; z-index:70; }
.modal--open{ display:grid; }
.modal__backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.35); backdrop-filter:blur(2px); }
.modal__panel{ position:relative; width:min(640px,94vw); padding:18px; }
.modal__header{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; }
.modal__title{ color:#eafff7; font-weight:800; }
.modal__close{
  width:36px; height:36px; border-radius:10px; display:grid; place-items:center;
  background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.22); color:#eafff7; cursor:pointer;
}
.form{ display:grid; gap:12px; }
.input{
  width:100%; padding:10px 12px; border-radius:10px;
  background:rgba(255,255,255,.08); color:#eafff7; border:1px solid rgba(255,255,255,.22); outline:none;
}
.input::placeholder{ color:#cfeee3; }

/* Tabs playlist – cùng chất kính, cho phép xuống dòng */
/* Tabs – style thống nhất, lấy màu từ token */
.tabs{
  display:flex;
  gap:8px;
  padding:6px;
  background:rgba(255,255,255,.10);
  border:1px solid rgba(255,255,255,.22);
  border-radius:12px;
}
.tab{
  display:inline-flex; align-items:center; justify-content:center;
  padding:6px 12px;
  border-radius:999px;
  background:rgba(255,255,255,.14);
  border:1px solid rgba(255,255,255,.25);
  color:var(--pill-text);
  font-weight:800; font-size:13px; line-height:1;
  cursor:pointer;
  transition:transform .12s ease, background .12s ease, border-color .12s ease;
}
.tab:hover{ transform:translateY(-1px); background:rgba(255,255,255,.20); }
.tab--active{
  background:color-mix(in oklab, var(--brand) 18%, transparent);
  border-color:color-mix(in oklab, var(--brand) 45%, transparent);
  box-shadow:0 0 0 1px color-mix(in oklab, var(--brand) 25%, transparent) inset;
}

/* Modifier & utility – tái dùng ở bất kỳ nơi nào cần */
.tabs--wrap{ flex-wrap:wrap; }        /* cho phép xuống dòng */
.u-break{ flex-basis:100%; height:0; }/* phần tử ngắt dòng */

/* .lib-grid, .lib-card, .lib-cover, .lib-title, .lib-author — dùng nguyên như hiện tại */


/* Backdrop & blur khi mở auth (tương thích glue hiện có) */
#authBackdrop[hidden], #authModal[hidden]{ display:none !important; }
#authBackdrop{
  position:fixed; inset:0; background:rgb(0 0 0 / .45);
  backdrop-filter:blur(2px); -webkit-backdrop-filter:blur(2px);
  opacity:0; transition:opacity .18s ease; pointer-events:none; z-index:999;
}
body.body-auth-open #authBackdrop{ opacity:1; pointer-events:auto; }
body.body-auth-open .stage,
body.body-auth-open .nini-layout{ filter:blur(4px); }

/* ---------------------------- 10) Responsive ---------------------------- */
@media (max-width:1100px){
  .nini-layout{ grid-template-columns:220px 1fr; }
  .nini-middle{ grid-column:1 / -1; order:3; }
}
@media (max-width:800px){
  .nini-header{ grid-template-columns:1fr auto; row-gap:8px; }
  .nh-nav{ grid-column:1 / -1; justify-content:center; flex-wrap:wrap; }
}
@media (max-width:700px){
  .nini-layout{ grid-template-columns:1fr; }
  .nini-side{ order:1; }
  .nini-main{ order:2; }
  .nini-middle{ order:3; }
}

/* ---------------------------- 11) Safeguards ---------------------------- */
/* tránh lớp trang trí chặn click */
.stage::before, .stage::after,
.panel::before, .panel::after { pointer-events:none !important; }

/* ==== Sidebar icons: tròn + glass trong ==== */
.nini-side{
  background: rgba(255,255,255,.12);    /* trong hơn */
  border: 1px solid rgba(255,255,255,.28);
  box-shadow: 0 10px 24px rgba(0,0,0,.10);
}

.side-icons{ gap: 16px; }

.icon-btn{
  padding: 0;                           /* bỏ padding cho khung tròn “sạch” */
}

.icon-btn .icon{
  width: 52px;                          /* lớn hơn một chút */
  height: 52px;
  border-radius: 999px;                 /* tròn 100% */
  display: grid; place-items: center;
  background: rgba(255,255,255,.18);    /* glass nhẹ */
  border: 1px solid rgba(255,255,255,.35);
  box-shadow: 0 6px 16px rgba(255,255,255,.10) inset,
              0 8px 20px rgba(255,255,255,.08);
  transition: transform .12s ease, background .12s ease, box-shadow .12s ease;
}

.icon-btn .icon:hover{
  transform: translateY(-1px);
  background: rgba(255,255,255,.26);
  box-shadow: 0 4px 12px rgba(255,255,255,.08) inset,
              0 10px 24px rgba(255,255,255,.10);
}

.icon-btn img{
  width: 26px; height: 26px;            /* icon bên trong */
  object-fit: contain; display: block;
}

/* Tooltip giữ nguyên như cũ */

/* ==== Header brand logo: ép vuông, không méo ==== */
.brand-logo{
  width: 100px; height: 40px;
  border-radius: 1px;   /* tuỳ: 0 (vuông), 8-10 (bo góc) */
  object-fit: cover;     /* fill khung, không méo */
  aspect-ratio: 1 / 1;   /* khoá tỉ lệ 1:1 */
  display: block;
  background: url('/public/assets/icons/logo_text.webp') left center/contain no-repeat;
}
.brand-slogan{
  color:#fff; opacity:.9; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  text-shadow: 0 1px 2px rgba(0,0,0,.5);
}

/* Khung ảnh 16:9 cố định + ảnh fill tuyệt đối (không bị lệch) */
.reader-stage{
  display: grid;
  gap: 12px;
}

.reader-image{
  position: relative;
  width: 100%;
  aspect-ratio: 16 / 9;
  border-radius: 14px;
  overflow: hidden;          /* cắt phần thừa cho bo góc */
  background: rgba(0,0,0,.06);
  margin: 0 auto;            /* luôn căn giữa theo chiều ngang */
}

/* Ảnh fill toàn bộ khung — không bị ảnh hưởng bởi rule height:auto cũ */
.reader-image > img#reader_img{
  position: absolute;
  inset: 0;                  /* top:0; right:0; bottom:0; left:0 */
  width: 100% !important;
  height: 100% !important;   /* quan trọng: ép cao đúng khung */
  max-width: none !important;
  object-fit: cover;         /* đẹp, có thể crop nhẹ */
  display: block;            /* bỏ khoảng trống baseline của img */
  border-radius: 0;          /* bo góc đã do .reader-image đảm nhiệm */
}
#sb-auth-slot .icon img{
  width:26px; height:26px;
  border-radius:8px;          /* vuông bo nhẹ để khác avatar tròn */
  object-fit:cover;
}
.char-shell {
  display: grid;
  grid-template-columns: 360px 1fr;
  gap: 18px;
}
.char-controls {
  position: sticky;
  top: 90px; /* tùy header */
  align-self: start;
  padding: 14px;
  border-radius: 14px;
  background: rgba(255,255,255,.08);
  backdrop-filter: blur(6px);
}
.char-controls label { margin-top: 10px; display:block; font-weight:600; }
.char-controls select { width:100%; padding:8px; border-radius:8px; margin-top:6px; }

.actions { margin-top:14px; display:flex; gap:8px; }
.actions button { padding:10px 12px; border-radius:10px; }

.char-preview .preview-card,
.char-preview .prompt-card {
  padding: 14px;
  border-radius: 14px;
  background: rgba(255,255,255,.06);
  backdrop-filter: blur(6px);
  margin-bottom: 14px;
}

@media (max-width: 980px) {
  .char-shell { grid-template-columns: 1fr; }
  .char-controls { position: static; }
}

.btn{padding:8px 12px;border-radius:8px;border:1px solid var(--brand-5);background:#fff;cursor:pointer}
.btn.brand{background:var(--brand-4);color:#fff;border-color:transparent}
.btn:disabled{opacity:.6;cursor:not-allowed}

/* ==== FORM THEME – áp cho input trong .card (Character Builder, v.v.) ==== */
.card input[type="text"],
.card input[type="number"],
.card input[type="email"],
.card input[type="password"],
.card textarea,
.card select {
  width: 100%;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.28);
  background: rgba(255,255,255,.18);
  color: #0f172a;
  outline: none;
  transition: border-color .12s ease, box-shadow .12s ease, background .12s ease;
  box-shadow: 0 4px 10px rgba(0,0,0,.06) inset;
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}

.card textarea { min-height: 120px; resize: vertical; }

/* placeholder mềm hơn */
.card input::placeholder,
.card textarea::placeholder { color:#64748b; opacity:.9; }

/* trạng thái focus */
.card input:focus,
.card textarea:focus,
.card select:focus {
  border-color: color-mix(in oklab, var(--brand) 55%, #ffffff 0%);
  box-shadow: 0 0 0 3px color-mix(in oklab, var(--brand) 22%, transparent);
  background: rgba(255,255,255,.22);
}

/* select gọn đẹp */
.card select {
  appearance: none;
  background-image:
    linear-gradient(45deg, transparent 50%, #0f172a 50%),
    linear-gradient(135deg, #0f172a 50%, transparent 50%),
    linear-gradient(to right, transparent, transparent);
  background-position:
    calc(100% - 18px) calc(50% - 3px),
    calc(100% - 12px) calc(50% - 3px),
    calc(100% - 40px) 50%;
  background-size: 6px 6px, 6px 6px, 1px 60%;
  background-repeat: no-repeat;
  padding-right: 40px;
}

/* label đẹp hơn một chút */
.card label { display:block; font-weight:700; margin:8px 0 6px; color:#0f172a; }

/* nhóm nút hành động */
.card .row .ghost { background:transparent; border:1px solid rgba(255,255,255,.35); color:#0f172a; }
.card .row .ghost:hover { background:rgba(255,255,255,.3); }

/* làm .card nổi & hòa nền rừng hơn */
.card{
  background: rgba(255,255,255,.22);
  border: 1px solid rgba(255,255,255,.35);
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,.18);
  backdrop-filter: blur(12px) saturate(140%);
  -webkit-backdrop-filter: blur(12px) saturate(140%);
}

/* tiêu đề thẻ */
.card h3 { margin: 6px 0 10px; font-size: 18px; font-weight: 900; color:#0f172a; }

.btn { padding:10px 14px; border-radius:12px; border:1px solid rgba(0,0,0,.06);
       background: var(--brand); color:#052e1a; font-weight:800; box-shadow:0 6px 18px rgba(34,197,94,.28); }
.btn:hover { transform: translateY(-1px); }
.btn.brand { background: var(--brand-2); color:#fff; border-color: transparent; }
.btn.ghost { background: transparent; border:1px solid rgba(255,255,255,.35); color:#0f172a; }
.btn:disabled { opacity:.6; cursor:not-allowed; }

/* Sidebar glass nhẹ */
.nini-side{
  background: rgba(255,255,255,.14);
  border: 1px solid rgba(255,255,255,.32);
  box-shadow: 0 10px 24px rgba(0,0,0,.10);
  backdrop-filter: blur(4px);
}

/* nút thường – kính mờ, chữ nâu */
[data-tool].icon-btn .icon{
  width:52px;height:52px;border-radius:999px;
  background: rgba(255,255,255,.18);
  border:1.6px solid rgba(255,255,255,.75);
  backdrop-filter: blur(8px) saturate(140%);
  box-shadow: inset 0 6px 14px rgba(255,255,255,.06);
  color:#6b4f3b; /* nâu dịu */
}
[data-tool].icon-btn .lbl{ color:#6b4f3b; }

/* hover */
[data-tool].icon-btn .icon:hover{
  background: rgba(255,255,255,.26);
  border-color:#ffffff;
}

/* trạng thái được CHỌN */
[data-tool].active .icon{
  background:#ffffff;
  border:2px solid #ffffff;          /* viền trắng */
  color:#1f2937;                     /* chữ tối */
  box-shadow:0 10px 22px rgba(0,0,0,.18);
}
[data-tool].active .lbl{ color:#1f2937; }




