<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Web Story Editor</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    body {
      position: relative;
      color: #fff;
      /* Nền trang phủ full màn hình với ảnh, căn giữa, không lặp, hiệu ứng mờ nhẹ */
    }
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url("/public/assets/bg/nini_home.webp") center center no-repeat;
      background-size: cover;
      filter: blur(5px);
      z-index: -1;
    }
    .editor-content {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
    }
    .section {
      margin-bottom: 2rem;
    }
    h2, h3 {
      margin: 0 0 1rem 0;
    }
    h3 {
      font-size: 1.2em;
      margin-top: 1rem;
    }
    label {
      display: block;
      margin-bottom: 0.25rem;
      font-weight: normal;
    }
    input, textarea {
      display: block;
      width: 100%;
      padding: 0.5rem 0;
      border: none;
      border-bottom: 1px solid #fff;
      background: transparent;
      color: #fff;
      margin-bottom: 1rem;
    }
    input:focus, textarea:focus {
      outline: none;
      border-bottom: 2px solid #fff;
    }
    textarea {
      resize: vertical;
    }
    button {
      background: transparent;
      border: 1px solid #fff;
      color: #fff;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
      border-radius: 3px;
      margin-right: 1rem;
    }
    button:hover {
      background: #fff;
      color: #000;
    }
    .hash-label {
      display: inline-block;
      margin-left: 1rem;
      font-weight: normal;
    }
    .hash-label input {
      margin-right: 0.25rem;
    }
  </style>
</head>
<body>
  <div class="editor-content">
    <!-- Thông tin Sách -->
    <div class="section book-section">
      <h2>Thông tin Sách</h2>
      <label for="bookId">ID Sách:</label>
      <input type="text" id="bookId" placeholder="ID Sách" />
      <label for="titleVi">Tiêu đề (VI):</label>
      <input type="text" id="titleVi" placeholder="Tiêu đề tiếng Việt" />
      <label for="titleEn">Tiêu đề (EN):</label>
      <input type="text" id="titleEn" placeholder="Tiêu đề tiếng Anh" />
      <label for="author">Tác giả:</label>
      <input type="text" id="author" placeholder="Tác giả" />
      <label for="design">Thiết kế:</label>
      <input type="text" id="design" placeholder="Thiết kế" />
      <label for="cover">Ảnh bìa:</label>
      <input type="text" id="cover" placeholder="Đường dẫn ảnh bìa" />
    </div>
    <!-- Khu vực Thao tác -->
    <div class="section actions-section">
      <button type="button" id="generateManifest">Tạo Manifest</button>
      <label class="hash-label"><input type="checkbox" id="includeHash" /> Thêm #hash vào liên kết</label>
    </div>
    <!-- Danh sách Các Trang -->
    <div class="section pages-section">
      <h2>Các Trang</h2>
      <div id="pagesContainer">
        <div class="page-entry">
          <h3>Trang 1</h3>
          <label>ID trang:</label>
          <input type="text" class="page-id" placeholder="ID trang" />
          <label>Nội dung (VI):</label>
          <textarea class="page-text-vi" placeholder="Nội dung tiếng Việt"></textarea>
          <label>Nội dung (EN):</label>
          <textarea class="page-text-en" placeholder="Nội dung tiếng Anh"></textarea>
          <label>Hình ảnh:</label>
          <input type="text" class="page-image" placeholder="Đường dẫn hình ảnh" />
          <label>Âm thanh (VI):</label>
          <input type="text" class="page-sound-vi" placeholder="Đường dẫn âm thanh tiếng Việt" />
          <label>Âm thanh (EN):</label>
          <input type="text" class="page-sound-en" placeholder="Đường dẫn âm thanh tiếng Anh" />
        </div>
      </div>
      <button type="button" id="addPage">Thêm Trang</button>
    </div>
    <!-- Kết quả Manifest JSON -->
    <div class="section manifest-section">
      <h2>Kết quả Manifest</h2>
      <pre id="manifestOutput"></pre>
    </div>
  </div>
  <script>
    // Hàm tiện ích tạo chuỗi hash ngẫu nhiên
    function generateHash() {
      return Math.random().toString(36).substr(2, 6);
    }
    // Xử lý thêm trang mới
    let pageCount = 1;
    document.getElementById('addPage').addEventListener('click', () => {
      pageCount++;
      const pagesContainer = document.getElementById('pagesContainer');
      const pageDiv = document.createElement('div');
      pageDiv.className = 'page-entry';
      pageDiv.innerHTML = `
        <h3>Trang ${pageCount}</h3>
        <label>ID trang:</label>
        <input type="text" class="page-id" placeholder="ID trang" />
        <label>Nội dung (VI):</label>
        <textarea class="page-text-vi" placeholder="Nội dung tiếng Việt"></textarea>
        <label>Nội dung (EN):</label>
        <textarea class="page-text-en" placeholder="Nội dung tiếng Anh"></textarea>
        <label>Hình ảnh:</label>
        <input type="text" class="page-image" placeholder="Đường dẫn hình ảnh" />
        <label>Âm thanh (VI):</label>
        <input type="text" class="page-sound-vi" placeholder="Đường dẫn âm thanh tiếng Việt" />
        <label>Âm thanh (EN):</label>
        <input type="text" class="page-sound-en" placeholder="Đường dẫn âm thanh tiếng Anh" />
      `;
      pagesContainer.appendChild(pageDiv);
    });
    // Xử lý tạo JSON manifest khi bấm nút
    document.getElementById('generateManifest').addEventListener('click', () => {
      const includeHash = document.getElementById('includeHash').checked;
      const manifest = {
        id: document.getElementById('bookId').value,
        title_vi: document.getElementById('titleVi').value,
        title_en: document.getElementById('titleEn').value,
        author: document.getElementById('author').value,
        design: document.getElementById('design').value,
        cover: document.getElementById('cover').value,
        pages: []
      };
      // Thêm hash vào cover nếu tùy chọn bật
      if (includeHash && manifest.cover) {
        manifest.cover += '#' + generateHash();
      }
      // Lặp qua từng trang để thu thập dữ liệu
      document.querySelectorAll('.page-entry').forEach(page => {
        const pageData = {
          id: page.querySelector('.page-id').value,
          text_vi: page.querySelector('.page-text-vi').value,
          text_en: page.querySelector('.page-text-en').value,
          image: page.querySelector('.page-image').value,
          sound_vi: page.querySelector('.page-sound-vi').value,
          sound_en: page.querySelector('.page-sound-en').value
        };
        // Thêm hash vào các link hình/âm thanh nếu có tùy chọn
        if (includeHash) {
          if (pageData.image) pageData.image += '#' + generateHash();
          if (pageData.sound_vi) pageData.sound_vi += '#' + generateHash();
          if (pageData.sound_en) pageData.sound_en += '#' + generateHash();
        }
        manifest.pages.push(pageData);
      });
      // Chuyển đối tượng thành chuỗi JSON và hiển thị
      const jsonStr = JSON.stringify(manifest, null, 2);
      document.getElementById('manifestOutput').textContent = jsonStr;
    });
  </script>
</body>
</html>
